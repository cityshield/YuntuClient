cmake_minimum_required(VERSION 3.16)
project(YuntuClient_Test VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# 查找 Qt6
find_package(Qt6 REQUIRED COMPONENTS
    Core
    Network
    Sql
    WebSockets
)

# 包含目录
include_directories(${CMAKE_SOURCE_DIR}/src)

# 测试程序源文件
set(TEST_SOURCES
    src/test_main.cpp

    # Core
    src/core/Application.cpp
    src/core/Config.cpp
    src/core/Logger.cpp

    # Network
    src/network/HttpClient.cpp
    src/network/WebSocketClient.cpp
    src/network/ApiService.cpp
    src/network/FileUploader.cpp

    # Services
    src/services/MayaDetector.cpp
)

# 测试程序头文件
set(TEST_HEADERS
    src/core/Application.h
    src/core/Config.h
    src/core/Logger.h
    src/network/HttpClient.h
    src/network/WebSocketClient.h
    src/network/ApiService.h
    src/network/FileUploader.h
    src/services/MayaDetector.h
)

# 创建测试可执行文件
add_executable(${PROJECT_NAME}
    ${TEST_SOURCES}
    ${TEST_HEADERS}
)

# 链接 Qt 库
target_link_libraries(${PROJECT_NAME}
    Qt6::Core
    Qt6::Network
    Qt6::Sql
    Qt6::WebSockets
)

# Windows 特定设置
if(WIN32)
    # 保留控制台窗口
    # set_target_properties(${PROJECT_NAME} PROPERTIES
    #     WIN32_EXECUTABLE FALSE
    # )
endif()

# 安装规则
install(TARGETS ${PROJECT_NAME}
    RUNTIME DESTINATION bin
)
